C51 COMPILER V9.54   MAIN                                                                  09/05/2022 21:27:49 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Key.h"
   5          #include "Timer0.h"
   6          
   7          void TimeShow(void);
   8          void TimeSet(void);
   9          
  10          unsigned char keyNum;                   //ÂàùÂßãÂåñÁã¨Á´ãÊåâÈîÆÈîÆÁ†Å
  11          unsigned char mode;                             //ÂàùÂßãÂåñÊó∂ÈíüÊòæÁ§∫Ê®°Âºè
  12          unsigned char timeSetSelect;    //ÂàùÂßãÂåñÊó∂Èó¥‰øÆÊîπÁ¥¢ÂºïÔºå‰∏∫DS1302.c‰∏≠ÁöÑDS1302_Time[]ÁöÑÊï∞ÁªÑÁ¥¢Âºï
  13          unsigned char timeSetFlashFlag; //ÂàùÂßãÂåñÊó∂Èó¥‰øÆÊîπÂà∑Êñ∞Ê†áÂøó‰Ωç
  14          
  15          void main()
  16          {
  17   1              LCD_Init();                                     //ÂàùÂßãÂåñLCD
  18   1              DS1302_Init();                          //ÂàùÂßãÂåñDS1302
  19   1              Timer0_Init();                          //ÂàùÂßãÂåñÂÆöÊó∂Âô®0
  20   1              
  21   1              DS1302_SetTime();                       //‰∏äÁîµÂ∞±Á´ãÂç≥ÂºÄÂßãËÆæÁΩÆÂ•ΩÊó∂Èíü
  22   1              
  23   1              LCD_ShowString(1, 3, "-");      //Âá∫‰∫éÁæéËßÇËÄÉËôëÔºåÊòæÁ§∫ "-"
  24   1              LCD_ShowString(1, 6, "-");
  25   1              LCD_ShowString(2, 3, "-");
  26   1              LCD_ShowString(2, 6, "-");
  27   1              
  28   1              while (1)
  29   1              {
  30   2                      keyNum = Key();                 //Ëé∑ÂèñÁã¨Á´ãÊåâÈîÆÈîÆÁ†ÅÔºåÊåâ‰∏ãK1-1ÔºåK2-2ÔºåK3-3ÔºåK4-4Ôºå‰∏çÊåâËøîÂõû0
  31   2                      if (keyNum == 1)                //ÊåâÈîÆK1Ë¥üË¥£ÂàáÊç¢Ê®°Âºè
  32   2                      {
  33   3                              if (mode == 1)
  34   3                              {
  35   4                                      mode = 0;
  36   4                                      DS1302_SetTime();       //ÊØèÊ¨°‰ªé‰øÆÊîπÊ®°ÂºèÂàáÊç¢Ëá≥ÊòæÁ§∫Ê®°ÂºèÔºåÂ∞±Á´ãÂç≥Áî®‰øÆÊîπÂÄºËøõË°å‰øÆÊîπ
  37   4                              }
  38   3                              else if (mode == 0)
  39   3                                      mode = 1;
  40   3                      }               
  41   2                      
  42   2                      switch (mode)                   //0‰∏∫ÊòæÁ§∫Ê®°ÂºèÔºå1‰∏∫‰øÆÊîπÊ®°Âºè
  43   2                      {
  44   3                              case 0: TimeShow(); break;
  45   3                              case 1: TimeSet(); break;
  46   3                      }
  47   2              }
  48   1      }
  49          
  50          /**
  51            * @brief      ÊòæÁ§∫Ê®°ÂºèÂáΩÊï∞
  52            * @param      Êó†
  53            * @retval     Êó†
  54            *     ÈÄöËøáÊâßË°åDS1302_ReadTime();Ôºå‰∏çÊñ≠Âà∑Êñ∞Êó∂Èó¥ÂÄº
C51 COMPILER V9.54   MAIN                                                                  09/05/2022 21:27:49 PAGE 2   

  55            */
  56          void TimeShow(void)
  57          {
  58   1              DS1302_ReadTime();                                              //ËØªÂèñDS1302ÁöÑÂØÑÂ≠òÂô®Êï∞ÂÄºÂπ∂ËΩ¨Êç¢‰∏∫ÂçÅËøõÂà∂ÔºåÂ≠òÂÖ•DS1302_Time[]Êï∞ÁªÑ
  59   1              LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  60   1              LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  61   1              LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  62   1              LCD_ShowNum(2, 1, DS1302_Time[3], 2);
  63   1              LCD_ShowNum(2, 4, DS1302_Time[4], 2);
  64   1              LCD_ShowNum(2, 7, DS1302_Time[5], 2);
  65   1      }
  66          
  67          /**
  68            * @brief      ‰øÆÊîπÊ®°ÂºèÂáΩÊï∞
  69            * @param      Êó†
  70            * @retval     Êó†
  71            */
  72          void TimeSet(void)
  73          {
  74   1              //K2Ë¢´Êåâ‰∏ãÔºåÈÄâÊã©‰øÆÊîπ‰ΩçÔºå‰ª•timeSetSelect‰∏∫Á¥¢Âºï‰øÆÊîπDS1302_Time[]Êó∂Èó¥Êï∞ÁªÑÔºåÊåâ‰∏ã‰∏ÄÊ¨°
             -Â¢ûÂä†‰∏ÄÊ¨°ÔºåÂÖ∑ÊúâË∂äÁïåÂà§Êñ≠ÂäüËÉΩ
  75   1              if (keyNum == 2)
  76   1              {
  77   2                      timeSetSelect ++;
  78   2                      timeSetSelect %= 6;             //Ë∂äÁïåÊ∏ÖÈõ∂ÔºåÁ≠âÊïà‰∫é‚Üì
  79   2                                                                      //if (timeSetSelect > 5)
  80   2                                                                      //timeSetSelect = 0;
  81   2                      //ÊàñËÄÖÂèØ‰ª•Áõ¥Êé•ÁÆÄÂÜô‰∏∫Ôºö
  82   2                      //timeSetSelect++ %= 6;
  83   2              }
  84   1      
  85   1              //K3Ë¢´Êåâ‰∏ãÔºåÂØπÂ∫îË¢´ÈÄâ‰∏≠ÁöÑ‰øÆÊîπ‰ΩçÊï∞ÂÄºÈÄíÂ¢ûÔºåÊåâ‰∏ã‰∏ÄÊ¨°Â¢ûÂä†‰∏ÄÊ¨°ÔºåÂÖ∑ÊúâË∂äÁïåÂà§Êñ≠Âä
             -üËÉΩ
  86   1              if (keyNum == 3)
  87   1              {
  88   2                      //ÂØπÂ∫îË¢´ÈÄâ‰∏≠ÁöÑ‰øÆÊîπ‰ΩçÊï∞ÂÄºÈÄíÂ¢û
  89   2                      DS1302_Time[timeSetSelect] ++;
  90   2                      
  91   2                      //Ë∂äÁïåÂà§Êñ≠
  92   2                      //Âπ¥
  93   2                      if (DS1302_Time[0] > 99) {DS1302_Time[0] = 0;}
  94   2                      
  95   2                      //Êúà
  96   2                      if (DS1302_Time[1] > 12) {DS1302_Time[1] = 1;}
  97   2                      
  98   2                      //Êó•
  99   2                      //Â§ßÊúà
 100   2                      if ((DS1302_Time[1] == 1) || (DS1302_Time[1] == 3) || (DS1302_Time[1] == 5) ||
 101   2                               (DS1302_Time[1] == 7) || (DS1302_Time[1] == 8) || (DS1302_Time[1] == 10) || (DS1302_Time[1] == 12))
 102   2                      {
 103   3                              if (DS1302_Time[2] > 31)
 104   3                                      DS1302_Time[2]  = 1;
 105   3                      }
 106   2                      //Â∞èÊúà
 107   2                      else if ((DS1302_Time[1] == 4) || (DS1302_Time[1] == 6) || (DS1302_Time[1] == 9) ||
 108   2                               (DS1302_Time[1] == 11))
 109   2                      {
 110   3                              if (DS1302_Time[2] > 30)
 111   3                                      DS1302_Time[2]  = 1;
 112   3                      }
 113   2                      //‰∫åÊúà
 114   2                      else if (DS1302_Time[1] == 2)
C51 COMPILER V9.54   MAIN                                                                  09/05/2022 21:27:49 PAGE 3   

 115   2                      {
 116   3                              //Èó∞Âπ¥‰∫åÊúà29Â§©
 117   3                              if (DS1302_Time[0] % 4 == 0)
 118   3                              {
 119   4                                      if (DS1302_Time[2] > 29)
 120   4                                              DS1302_Time[2] = 1;
 121   4                              }
 122   3                              //Âπ≥Âπ¥‰∫åÊúà28Â§©
 123   3                              else
 124   3                              {
 125   4                                      if (DS1302_Time[2] > 28)
 126   4                                              DS1302_Time[2] = 1;
 127   4                              }
 128   3                      }
 129   2                      
 130   2                      //Êó∂
 131   2                      if (DS1302_Time[3] > 23) {DS1302_Time[3] = 0;}
 132   2                      
 133   2                      //ÂàÜ
 134   2                      if (DS1302_Time[4] > 59) {DS1302_Time[4] = 0;}
 135   2                      
 136   2                      //Áßí
 137   2                      if (DS1302_Time[5] > 59) {DS1302_Time[5] = 0;}
 138   2              }
 139   1              
 140   1              //K4Ë¢´Êåâ‰∏ãÔºåÂØπÂ∫îË¢´ÈÄâ‰∏≠ÁöÑ‰øÆÊîπ‰ΩçÊï∞ÂÄºÈÄíÂáèÔºåÊåâ‰∏ã‰∏ÄÊ¨°ÂáèÂ∞ë‰∏ÄÊ¨°ÔºåÂÖ∑ÊúâË∂äÁïåÂà§Êñ≠Âä
             -üËÉΩ
 141   1              if (keyNum == 4)
 142   1              {
 143   2                      //ÂØπÂ∫îË¢´ÈÄâ‰∏≠ÁöÑ‰øÆÊîπ‰ΩçÊï∞ÂÄºÈÄíÂáè
 144   2                      DS1302_Time[timeSetSelect] --;
 145   2                      
 146   2                      //Ë∂äÁïåÂà§Êñ≠
 147   2                      //Ê≥®ÊÑèÔºåÂáèÁöÑÊó∂ÂÄô‰πüÈúÄË¶ÅÂØπËøáÂ§ßÊï∞ÂÄºËøõË°åÂà§Êñ≠
 148   2                      //Âπ¥
 149   2                      if (DS1302_Time[0] < 0) {DS1302_Time[0] = 99;}
 150   2                      if (DS1302_Time[0] > 99) {DS1302_Time[0] = 0;}
 151   2                      
 152   2                      //Êúà
 153   2                      if (DS1302_Time[1] < 1) {DS1302_Time[1] = 12;}
 154   2                      if (DS1302_Time[1] > 12) {DS1302_Time[1] = 1;}
 155   2                      
 156   2                      //Êó•
 157   2                      //Â§ßÊúà
 158   2                      if ((DS1302_Time[1] == 1) || (DS1302_Time[1] == 3) || (DS1302_Time[1] == 5) ||
 159   2                               (DS1302_Time[1] == 7) || (DS1302_Time[1] == 8) || (DS1302_Time[1] == 10) || (DS1302_Time[1] == 12))
 160   2                      {
 161   3                              if (DS1302_Time[2] < 1)
 162   3                                      DS1302_Time[2]  = 31;
 163   3                              if (DS1302_Time[2] > 31)
 164   3                                      DS1302_Time[2]  = 1;
 165   3                      }
 166   2                      //Â∞èÊúà
 167   2                      else if ((DS1302_Time[1] == 4) || (DS1302_Time[1] == 6) || (DS1302_Time[1] == 9) ||
 168   2                               (DS1302_Time[1] == 11))
 169   2                      {
 170   3                              if (DS1302_Time[2] < 1)
 171   3                                      DS1302_Time[2]  = 30;
 172   3                              if (DS1302_Time[2] > 30)
 173   3                                      DS1302_Time[2]  = 1;
 174   3                      }
 175   2                      //‰∫åÊúà
C51 COMPILER V9.54   MAIN                                                                  09/05/2022 21:27:49 PAGE 4   

 176   2                      else if (DS1302_Time[1] == 2)
 177   2                      {
 178   3                              //Èó∞Âπ¥‰∫åÊúà29Â§©
 179   3                              if (DS1302_Time[0] % 4 == 0)
 180   3                              {
 181   4                                      if (DS1302_Time[2] < 1)
 182   4                                              DS1302_Time[2] = 29;
 183   4                                      if (DS1302_Time[2] >29)
 184   4                                              DS1302_Time[2] = 1;
 185   4                              }
 186   3                              //Âπ≥Âπ¥‰∫åÊúà28Â§©
 187   3                              else
 188   3                              {
 189   4                                      if (DS1302_Time[2] < 1)
 190   4                                              DS1302_Time[2] = 28;
 191   4                                      if (DS1302_Time[2] > 28)
 192   4                                              DS1302_Time[2] = 1;
 193   4                              }
 194   3                      }
 195   2                      
 196   2                      //Êó∂
 197   2                      if (DS1302_Time[3] < 0) {DS1302_Time[3] = 23;}
 198   2                      if (DS1302_Time[3] > 23) {DS1302_Time[3] = 0;}
 199   2                      
 200   2                      //ÂàÜ
 201   2                      if (DS1302_Time[4] < 0) {DS1302_Time[4] = 59;}
 202   2                      if (DS1302_Time[4] > 59) {DS1302_Time[4] = 0;}
 203   2                      
 204   2                      //Áßí
 205   2                      if (DS1302_Time[5] < 0) {DS1302_Time[5] = 59;}
 206   2                      if (DS1302_Time[5] > 59) {DS1302_Time[5] = 0;}
 207   2              }
 208   1              
 209   1              //ÂØπ‰øÆÊîπËøõË°åÊòæÁ§∫
 210   1              
 211   1              //‰øÆÊîπÊó∂Èó¥Êó∂ÔºåFlashÂäüËÉΩÁöÑÂÆûÁé∞ÔºàÂØπÈÄâÊã©ÁöÑ‰øÆÊîπ‰ΩçËøõË°åÈó™ÁÉÅÊòæÁ§∫‰ª•‰æø‰∫éÁî®Êà∑Ë∞ÉËäÇÔº
             -âÔºö
 212   1              //ÂΩìÊó∂Èó¥‰ΩçÂ§Ñ‰∫é‰øÆÊîπÁä∂ÊÄÅÂπ∂‰∏îtimeSetFlashFlagÔºàÊó∂Èó¥‰øÆÊîπÂà∑Êñ∞Ê†áÂøó‰ΩçÔºâ‰∏∫1Êó∂ÔºåÊòæÁ§∫Á©
             -∫ÁôΩ„ÄÇ
 213   1              //‰∏çÂ§Ñ‰∫éÊ≠§Áä∂ÊÄÅÔºåÂàôÊòæÁ§∫Êó∂Èó¥ÂÄº
 214   1              if (timeSetSelect == 0 && timeSetFlashFlag == 1)        //Flash
 215   1                      LCD_ShowString(1, 1, "  ");                                             //Ê≠£Â∏∏ÊòæÁ§∫
 216   1              else
 217   1                      LCD_ShowNum(1, 1, DS1302_Time[0], 2);
 218   1              if (timeSetSelect == 1 && timeSetFlashFlag == 1)
 219   1                      LCD_ShowString(1, 4, "  ");
 220   1              else
 221   1                      LCD_ShowNum(1, 4, DS1302_Time[1], 2);
 222   1              if (timeSetSelect == 2 && timeSetFlashFlag == 1)
 223   1                      LCD_ShowString(1, 7, "  ");
 224   1              else
 225   1                      LCD_ShowNum(1, 7, DS1302_Time[2], 2);
 226   1              if (timeSetSelect == 3 && timeSetFlashFlag == 1)
 227   1                      LCD_ShowString(2, 1, "  ");
 228   1              else
 229   1                      LCD_ShowNum(2, 1, DS1302_Time[3], 2);
 230   1              if (timeSetSelect == 4 && timeSetFlashFlag == 1)
 231   1                      LCD_ShowString(2, 4, "  ");
 232   1              else
 233   1                      LCD_ShowNum(2, 4, DS1302_Time[4], 2);
 234   1              if (timeSetSelect == 5 && timeSetFlashFlag == 1)
 235   1                      LCD_ShowString(2, 7, "  ");
C51 COMPILER V9.54   MAIN                                                                  09/05/2022 21:27:49 PAGE 5   

 236   1              else
 237   1                      LCD_ShowNum(2, 7, DS1302_Time[5], 2);
 238   1      }
 239          
 240          /**
 241            * @brief      ÂÆöÊó∂Âô®0‰∏≠Êñ≠Á≥ªÁªüÊúçÂä°ÂáΩÊï∞
 242            * @param      Êó†
 243            * @retval     Êó†
 244            * ÂÆöÊó∂Âô®0ÊØè500ms‰øÆÊîπ‰∏ÄÊ¨°timeSetFlashFlagÁöÑÊï∞ÂÄºÔºåÂÆûÁé∞Flash‰∏éÊ≠£Â∏∏ÊòæÁ§∫ÁöÑÂàáÊç¢
 245            */
 246          void Timer0_Routine()   interrupt 1
 247          {
 248   1              static unsigned int t0Count;
 249   1              
 250   1              //ÊØèÊ¨°ËøõÂÖ•‰∏≠Êñ≠ÔºåTH-TLÈÉΩ‰ºöË¢´Ê∏ÖÈõ∂Ôºå‰∏çÁ¨¶ÂêàËÆ°Êó∂1msË¶ÅÊ±ÇÔºåÂõ†Ê≠§ÈúÄË¶ÅÈáçÊñ∞ËµãÂÄº
 251   1              TL0 = 0x66;                     
 252   1              TH0 = 0xFC;
 253   1              t0Count ++;
 254   1              if (t0Count >= 500)
 255   1              {
 256   2                      t0Count = 0;
 257   2                      timeSetFlashFlag =! timeSetFlashFlag;
 258   2              }
 259   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1053    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
